<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5shiv.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="lib/h-ui/css/H-ui.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/h-ui.admin/css/H-ui.admin.css" />
    <link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="lib/h-ui.admin/skin/green/skin.css" id="skin" />
    <link rel="stylesheet" type="text/css" href="lib/h-ui.admin/css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="layuiadmin/layui/css/layui.css">
    <!--[if IE 6]>
    <script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <title>管理平台</title>
</head>
<body style="position: relative;overflow: hidden">
<!--顶部导航-->
<header class="navbar-wrapper">
    <div class="navbar navbar-fixed-top">
        <div class="container-fluid cl defin">
            <div class="defin-logo">
                <!--<a href="index" class="logo navbar-logo f-l mr-10 hidden-xs">
                    <img src="" style="height: 48px; width: auto;margin-top: 3px;margin-right: 48px"/>
                </a>-->
            </div>
            <nav class="nav navbar-nav defin-nav">
                <ul class="cl">
                    <li class="navbar-levelone current" style="display: none"><a href="javascript:;">首页</a></li>
                    <li class="navbar-levelone menuli" style="display: none" id="htgl"><a href="javascript:;">合同管理</a></li>
                    <li class="navbar-levelone menuli" style="display: none" id="xtgl"><a href="javascript:;">系统管理</a></li>
                </ul>
            </nav>
            <nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs defin-admin">
                <ul class="cl">
                    <li class="dropDown dropDown_hover">
                        <a><i class="layui-icon">&#xe612;</i></a>
                        <input id="uid" type="hidden" th:value="${userid}"/>
                        <a id="userLabel" sec:authentication="name"></a>
                        <a href="#" id="userName" class="dropDown_A">
                            <i class="layui-icon">&#xe625;</i>
                        </a>
                        <ul class="dropDown-menu menu radius box-shadow layui-yohu">
                            <!-- <li><a href="javascript:void(0);" onClick="myselfinfo()">个人信息</a></li> -->
                            <li>
                                <a href="javascript:void(0);" onClick="editpwdHandler()"><i class="layui-icon">&#xe614; &nbsp;</i>修改密码</a>
                            </li>
                            <li>
                                <a href="/logout" ><i class="layui-icon">&#x1007; &nbsp;</i>退出</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<div class="layui-tab-item" style="margin-top: 10px;width: 100%;height:100%;position: absolute;">
    <div class="show_iframe">
        <div style="display:none" class="loading"></div>
<!--        <iframe scrolling="yes" frameborder="0" src="welcome" style="z-index: 2"></iframe>-->
    </div>
</div>

<!--左侧导航-->

<div class="layui-tab-item defin-aside">
    <aside class="Hui-aside">
        <h4 class="" style="font-weight: bold;">合同管理</h4>
        <div class="menu_dropdown">
            <div class="bk_2">
                <dl id="menu-numc1">
                    <dt><a data-href="contractlist" data-title="合同列表" href="javascript:void(0)" style="display:none" id="htlb"> <small class="layui-icon">&#xe63c;</small> 合同列表</a></dt>
                </dl>
                <dl id="menu-numc3">
                    <dt><a data-href="contracttype" data-title="合同类别管理" href="javascript:void(0)" style="display:none" id="htlbgl"> <small class="layui-icon">&#xe63c;</small>合同类别管理</a></dt>
                </dl>
            </div>
        </div>
    </aside>
</div>

<div class="layui-tab-item defin-aside">
    <aside class="Hui-aside">
        <h4 class="" style="font-weight: bold;">系统管理</h4>
        <div class="menu_dropdown">
            <div class="bk_2">
                <dl id="menu-xit1">
                    <dt><a data-href="userlist" data-title="用户管理" href="javascript:void(0)" style="display:none" id="yhgl"> <small class="layui-icon">&#xe63c;</small> 用户管理</a></dt>
                </dl>
                <dl id="menu-xit2">
                    <dt><a data-href="orglist" data-title="组织管理" href="javascript:void(0)" style="display:none" id="zzgl"> <small class="layui-icon">&#xe63c;</small> 组织管理</a></dt>
                </dl>
                <dl id="menu-xit3">
                    <dt><a data-href="organilist" data-title="组织机构管理" href="javascript:void(0)" style="display:none" id="zzjggl"> <small class="layui-icon">&#xe63c;</small> 组织机构管理</a></dt>
                </dl>
                <dl id="menu-xit4">
                    <dt><a data-href="rolelist" data-title="角色管理" href="javascript:void(0)" style="display:none" id="jsgl"> <small class="layui-icon">&#xe63c;</small> 角色管理</a></dt>
                </dl>
                <dl id="menu-xit5">
                    <dt><a data-href="pagelist" data-title="页面管理" href="javascript:void(0)" style="display:none" id="ymgl"> <small class="layui-icon">&#xe63c;</small> 页面管理</a></dt>
                </dl>
            </div>
        </div>
    </aside>
</div>
<!--显示隐藏三角-->
<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>
<!--内容导航显示-->
<section class="Hui-article-box" style="margin-top: 15px;">
    <div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
        <div class="Hui-tabNav-wp">
            <ul id="min_title_list" class="acrossTab cl">
                <li class="active">
                    <span title="主页" data-href="pages/welcome.html">主页</span>
                    <em></em>
                </li>
            </ul>
        </div>
        <div class="Hui-tabNav-more btn-group">
            <a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;"><i
                    class="Hui-iconfont">&#xe6d4;</i></a>
            <a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;"><i
                    class="Hui-iconfont">&#xe6d7;</i></a>
        </div>
    </div>
    <div id="iframe_box" class="Hui-article">
        <div class="show_iframe">
            <div style="display:none" class="loading"></div>
            <iframe scrolling="yes" frameborder="0" src="userlist"></iframe>
        </div>
    </div>
    <input id="uid" type="hidden" th:value="${userid}"/>
    <!--<a style="display:none;" id="userLabel" sec:authentication="name"></a>-->
</section>
<!--
<div class="contextMenu" id="Huiadminmenu">
    <ul>
        <li id="closethis">关闭当前 </li>
        <li id="closeall">关闭全部 </li>
    </ul>
</div>-->
<!--_footer 作为公共模版分离出去-->
    <script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="lib/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<!--<script type="text/javascript" src="lib/jquery.contextmenu/jquery.contextmenu.r2.js"></script>-->
<script type="text/javascript">
    $(function(){
        $("body").Huitab({
            tabBar:".navbar-wrapper .navbar-levelone",
            tabCon:".layui-tab-item",
            className:"current",
            index:0,
        });

        $(".menuli").parents().siblings(".dislpayArrow").hide();
        $(".current").click(function(){
            $(this).parents().siblings(".Hui-article-box").hide();
            $(this).parents().siblings(".dislpayArrow").hide();
        });
        $(".menuli").click(function(){
            $(this).parents().siblings(".dislpayArrow").show();
            $(this).parents().siblings(".Hui-article-box").show();
        });

        selpage();

    });

    function editpwdHandler() {
        var uid = document.getElementById("uid").value;
        var userStr = document.getElementById("userLabel").text;
        layer.open({
            type: 2
            ,title: '重置密码'
            ,content: 'resetPasswordform'
            ,maxmin: false
            ,area: ['460px', '290px']
            ,btn: ['确定', '取消']
            ,yes: function(index, layero){
                var body = layer.getChildFrame('body', index);
                var idStr = body.contents().find("#uid").val();
                var passStr = body.contents().find("#password").val();
                var passStr2 = body.contents().find("#password2").val();
                if(passStr.length < 6){
                    layer.msg("密码长度至少需要六位，请重新输入");
                    return;
                }
                if(passStr != passStr2){
                    layer.msg("两次输入的密码不一致，请重新输入");
                    return;
                }
                var jsonstr = {
                    "id":idStr,
                    "password":passStr
                };
                $.ajax({
                    url: 'sysuser/resetPassword',
                    type:"put",
                    contentType:"application/json",
                    data:JSON.stringify(jsonstr),
                    dataType: "json",
                    success: function (data) {

                        var status = data.optStatusCode;
                        if (status == 10400) {
                            layer.close(index); //关闭弹层
                            layer.msg("重置密码成功", {icon: 1});
                        } else {
                            layer.msg("重置密码失败");
                        }
                    },
                    error: function () {
                        layer.msg("重置密码失败");
                    }
                });
            }
            ,success: function (layero, index) {
                var body = layer.getChildFrame('body', index);
                body.contents().find("#uid").val(uid);
                body.contents().find("#username").val(userStr);
                body.contents().find("#username").attr("disabled", true);
            }
        });
    }

    function selpage(){
        var uid = document.getElementById("uid").value;
        $.ajax({
            url: 'syspage/queryPageById',
            type:"get",
           /* contentType:"application/json",*/
            data:{"userid":uid},
            dataType: "json",
            success: function (data) {
                pages = data['data']
                console.info(pages)
                $.getJSON("js/index.json", function (pageinfo){
                    for(var j=0;j<pageinfo.length;j++){
                        var pname = pageinfo[j].name;
                        var paid = pageinfo[j].id;
                        for(var i=0;i<pages.length;i++){
                            var paname = pages[i].name;
                            if(paname==pname){
                                document.getElementById(paid).style.display = "block";
                            }
                        }
                    }
                })

            },
            error: function () {
                layer.msg("页面加载失败");
            }
        });
    }


</script>
</body>
</html>